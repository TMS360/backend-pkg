syntax = "proto3";

package files;

option go_package = "github.com/TMS360/backend-pkg/proto/files";

service FilesService {
  rpc GetFile (GetFileRequest) returns (GetFileResponse);
  rpc GetFiles (GetFilesRequest) returns (GetFilesResponse);
  rpc Download (DownloadRequest) returns (stream DownloadResponse);
}

message GetFileRequest {
  string id = 1;
}

message GetFilesRequest {
  repeated string ids = 1;
}

message File {
  string id = 1;
  string url = 2;
  string s3_key = 3;
  string bucket = 4;
  string filename = 5;
  string mime_type = 6;
  int64 size_bytes = 7;
}

message GetFileResponse {
  File file = 1;
}

message GetFilesResponse {
  map<string, File> files = 1;
}

message DownloadRequest {
  string file_id = 1;
}

message DownloadResponse {
  // Oneof allows us to send metadata in the first chunk and data in others
  // Or we can just include metadata in every message (slightly more overhead)
  bytes chunk = 1;
  string file_name = 2;
  string content_type = 3;
}